<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>فهمان AI</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',Tahoma,sans-serif;}
body{background:#fff;color:#000;transition:background 0.3s,color 0.3s;}
body.dark-mode{background:#121212;color:#eee;}
.sidebar{position:fixed;top:0;left:-220px;width:220px;height:100vh;background:#f9f9f9;border-right:1px solid #ccc;padding:15px;display:flex;flex-direction:column;justify-content:space-between;transition:left 0.3s;z-index:999;}
.sidebar.active{left:0;}
.sidebar h3{font-size:20px;margin-bottom:15px;}
.sidebar ul{list-style:none;flex:1;}
.sidebar ul li{margin-bottom:10px;font-size:16px;cursor:pointer;color:#333;transition:color 0.3s;display:flex;align-items:center;gap:8px;}
.sidebar ul li:hover{color:#000;}
.sidebar ul li a.telegram-link{text-decoration:none;color:#000;font-weight:bold;display:flex;align-items:center;gap:5px;}
.bottom-buttons{margin-top:auto;display:flex;flex-direction:column;gap:10px;}
.bottom-buttons button{padding:10px;border:none;border-radius:8px;font-weight:bold;cursor:pointer;transition:background 0.3s;font-size:15px;color:#fff;}
.bottom-buttons button.upgrade{background:#28a745;}
.bottom-buttons button.logout{background:#e60000;}
.bottom-buttons button:hover{opacity:0.9;}
.main-layout{margin-left:0;transition:margin-left 0.3s;height:100vh;display:flex;flex-direction:column;}
.main-layout.shifted{margin-left:220px;}
.chat-header{background:transparent;text-align:center;padding:15px;font-size:24px;border-bottom:1px solid #ccc;position:relative;}
.settings-btn{position:absolute;left:10px;top:10px;background:none;border:1px solid #ccc;border-radius:20px;padding:5px 10px;cursor:pointer;font-size:18px;}
.chat-messages{padding:20px;display:flex;flex-direction:column;gap:10px;overflow-y:auto;flex-grow:1;position:relative;word-wrap:break-word;}
.message{font-size:17px;line-height:1.6;max-width:70%;padding:10px 15px;border-radius:18px;display:inline-block;word-wrap:break-word;white-space:pre-wrap;}
.user-message{text-align:left;direction:ltr;background:#e0f0ff;color:#000;font-weight:bold;align-self:flex-start;}
.bot-message{text-align:right;direction:rtl;background:#f1f1f1;color:#333;align-self:flex-end;position:relative;}
.copy-btn{font-size:12px;color:#000;cursor:pointer;position:absolute;bottom:-18px;right:5px;}
.typing-message{color:#999;font-style:italic;}
.chat-input{display:flex;border-top:1px solid #ccc;padding:10px;flex-shrink:0;background:#fff;align-items:center;gap:6px;}
.chat-input input[type="text"]{flex:1;padding:10px 15px;border:1px solid #ccc;border-radius:25px;font-size:16px;outline:none;}
.chat-input button{background:transparent;border:none;font-size:22px;padding:0 5px;cursor:pointer;transition:color 0.3s;}
.chat-input button.active{color:#007bff;} 
.chat-input label.upload-btn{font-size:20px;cursor:pointer;color:#555;padding:0 5px;transition:color 0.3s;}
.chat-input label.upload-btn:hover{color:#007bff;}
.chat-input input[type="file"]{display:none;}
.logo-center{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:220px;opacity:0.9;pointer-events:none;z-index:9999;}
.popup-menu{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.4);backdrop-filter:blur(5px);display:none;justify-content:center;align-items:center;z-index:10000;}
.popup-content{background:#111;color:#fff;padding:20px 25px;border-radius:12px;width:260px;display:flex;flex-direction:column;gap:12px;position:relative;}
.popup-content button{padding:8px;border:none;border-radius:8px;background:#222;color:#fff;cursor:pointer;transition:background 0.3s;font-weight:bold;}
.popup-content button:hover{background:#333;}
.popup-content .close-popup{position:absolute;top:10px;left:10px;background:#e60000;padding:5px 10px;border-radius:8px;font-weight:bold;}
.popup-content .close-popup:hover{background:#b30000;}

/* نافذة الثيمات */
.theme-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);justify-content:center;align-items:center;z-index:11000;}
.theme-box{background:#fff;padding:20px;border-radius:12px;max-width:600px;width:90%;text-align:center;}
.themes-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:15px;margin-top:20px;}
.theme-option{height:70px;border-radius:10px;cursor:pointer;border:2px solid #ddd;transition:transform 0.3s;}
.theme-option:hover{transform:scale(1.05);border-color:#555;}
</style>
</head>
<body>

<div class="sidebar" id="sidebar">
  <div>
    <h3>القائمة</h3>
    <ul>
      <li>
        <a href="https://t.me/Fahman_chat_ai" target="_blank" class="telegram-link">
          🕊 Telegram قناتنا
        </a>
      </li>
      <li onclick="showPopup('حول التطبيق')">حول التطبيق</li>
      <li onclick="showPopup('إدارة الحساب')">إدارة الحساب</li>
      <li onclick="showPopup('اللغة')">اللغة</li>
      <li onclick="showPopup('أخبار فهمان')">أخبار فهمان</li>
      <li onclick="showPopup('الدعم')">الدعم</li>
      <li onclick="openThemes()">الثيمات</li>
    </ul>
  </div>
  <div class="bottom-buttons">
    <button class="upgrade" onclick="window.location.href='vip.html'">الترقية</button>
    <button class="logout" onclick="window.location.href='index.html'">تسجيل الخروج</button>
  </div>
</div>

<div class="main-layout" id="mainLayout">
  <div class="chat-header">
    <button class="settings-btn" onclick="toggleSidebar()">☰</button>
    فهمان العراقي 🇮🇶
  </div>

  <div id="messages" class="chat-messages">
    <div class="message bot-message">أهلًا حبي، أني مطور من قبل المهندس محمد علي. اسأل أي شي يعجبك!
      <span class="copy-btn" onclick="copyMessage(this)">نسخ</span>
    </div>
    <img src="logo.png" alt="فهمان Ai Logo" class="logo-center">
  </div>

  <form id="input-area" class="chat-input">
    <input type="text" id="user-input" placeholder="اكتب سؤالك..." autocomplete="off">
    <button type="submit" id="send-btn">&#10148;</button>
    <label for="file-upload" class="upload-btn">＋</label>
    <input type="file" id="file-upload" multiple>
  </form>
</div>

<div class="popup-menu" id="popupMenu">
  <div class="popup-content" id="popupContent">
    <button class="close-popup" onclick="closePopup()">إلغاء</button>
    <div id="popupText" style="margin-top:25px;font-size:16px;">نص القائمة</div>
  </div>
</div>

<div class="theme-modal" id="themeModal">
  <div class="theme-box">
    <h3>اختر ثيم</h3>
    <div class="themes-grid">
      <div class="theme-option" data-colors="#f5f7fa,#c3cfe2" style="background:linear-gradient(135deg,#f5f7fa,#c3cfe2)"></div>
      <div class="theme-option" data-colors="#ffecd2,#fcb69f" style="background:linear-gradient(135deg,#ffecd2,#fcb69f)"></div>
      <div class="theme-option" data-colors="#a1c4fd,#c2e9fb" style="background:linear-gradient(135deg,#a1c4fd,#c2e9fb)"></div>
      <div class="theme-option" data-colors="#d4fc79,#96e6a1" style="background:linear-gradient(135deg,#d4fc79,#96e6a1)"></div>
      <div class="theme-option" data-colors="#fbc2eb,#a6c1ee" style="background:linear-gradient(135deg,#fbc2eb,#a6c1ee)"></div>
      <div class="theme-option" data-colors="#fdcbf1,#e6dee9" style="background:linear-gradient(135deg,#fdcbf1,#e6dee9)"></div>
      <div class="theme-option" data-colors="#fff1eb,#ace0f9" style="background:linear-gradient(135deg,#fff1eb,#ace0f9)"></div>
      <div class="theme-option" data-colors="#fdfcfb,#e2d1c3" style="background:linear-gradient(135deg,#fdfcfb,#e2d1c3)"></div>
      <div class="theme-option" data-colors="#d9a7c7,#fffcdc" style="background:linear-gradient(135deg,#d9a7c7,#fffcdc)"></div>
      <div class="theme-option" data-colors="#a18cd1,#fbc2eb" style="background:linear-gradient(135deg,#a18cd1,#fbc2eb)"></div>
      <div class="theme-option" data-colors="#ff9a9e,#fecfef" style="background:linear-gradient(135deg,#000000,#e0d5a1)"></div>
      <div class="theme-option" data-colors="#f6d365,#fda085" style="background:linear-gradient(135deg,#f6d365,#fda085)"></div>
    </div>
  </div>
</div>

<script>
const sidebar = document.getElementById('sidebar');
const mainLayout = document.getElementById('mainLayout');
const userInput = document.getElementById('user-input');
const inputArea = document.getElementById('input-area');
const chatMessages = document.getElementById('messages');
const popupMenu = document.getElementById('popupMenu');
const popupText = document.getElementById('popupText');
const sendBtn = document.getElementById('send-btn');
const fileUpload = document.getElementById('file-upload');
const themeModal = document.getElementById('themeModal');
const themeOptions = document.querySelectorAll('.theme-option');

function toggleSidebar(){sidebar.classList.toggle('active');mainLayout.classList.toggle('shifted');}
function showPopup(text){popupText.textContent=text+': هذه النافذة المنبثقة تعمل بنفس التصميم!';popupMenu.style.display='flex';}
function closePopup(){popupMenu.style.display='none';}

function openThemes(){themeModal.style.display='flex';}
window.addEventListener("click",e=>{if(e.target===themeModal)themeModal.style.display="none";});

themeOptions.forEach(option=>{
  option.addEventListener("click",()=>{
    const colors=option.getAttribute("data-colors").split(",");
    document.body.style.background=`linear-gradient(135deg,${colors[0]},${colors[1]})`;
    themeModal.style.display="none";
  });
});

inputArea.addEventListener('submit',async e=>{
  e.preventDefault();
  const text=userInput.value.trim();
  if(!text)return;
  addUserMessage(text);
  userInput.value='';
  sendBtn.classList.remove('active');
  sendToServer(text);
});

userInput.addEventListener('input',()=>{
  if(userInput.value.trim()!==""){sendBtn.classList.add('active');}
  else{sendBtn.classList.remove('active');}
});

fileUpload.addEventListener('change',()=>{
  [...fileUpload.files].forEach(file=>{
    if(file.type.startsWith('image/')){
      const img=document.createElement('img');
      img.src=URL.createObjectURL(file);
      img.style.maxWidth='120px';
      img.style.borderRadius='10px';
      img.style.display='block';
      const userMsg=document.createElement('div');
      userMsg.className='message user-message';
      userMsg.appendChild(img);
      chatMessages.appendChild(userMsg);
    }else{
      const link=document.createElement('a');
      link.href=URL.createObjectURL(file);
      link.textContent=file.name;
      link.download=file.name;
      link.style.color='#007bff';
      link.style.textDecoration='none';
      const userMsg=document.createElement('div');
      userMsg.className='message user-message';
      userMsg.appendChild(link);
      chatMessages.appendChild(userMsg);
    }
    chatMessages.scrollTop=chatMessages.scrollHeight;
  });
});

function addUserMessage(content){
  const userMsg=document.createElement('div');
  userMsg.className='message user-message';
  userMsg.textContent=content;
  chatMessages.appendChild(userMsg);
  chatMessages.scrollTop=chatMessages.scrollHeight;
}

function addBotMessage(content){
  const botMsg=document.createElement('div');
  botMsg.className='message bot-message';
  botMsg.textContent=content;
  const copyBtn=document.createElement('span');
  copyBtn.className='copy-btn';
  copyBtn.textContent='نسخ';
  copyBtn.onclick=function(){copyText(content);}
  botMsg.appendChild(copyBtn);
  chatMessages.appendChild(botMsg);
  chatMessages.scrollTop=chatMessages.scrollHeight;
}

function copyMessage(el){
  const text=el.parentElement.textContent.replace('نسخ','').trim();
  navigator.clipboard.writeText(text);
}

function copyText(text){navigator.clipboard.writeText(text);}

async function sendToServer(message){
  const typingMsg=document.createElement('div');
  typingMsg.className='message bot-message typing-message';
  typingMsg.textContent='جاري الكتابة...';
  chatMessages.appendChild(typingMsg);
  chatMessages.scrollTop=chatMessages.scrollHeight;

  try{
    const res=await fetch('http://localhost:3000/chat',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({message})
    });
    const data=await res.json();
    chatMessages.removeChild(typingMsg);
    addBotMessage(data.reply);
  }catch(err){
    chatMessages.removeChild(typingMsg);
    addBotMessage('حدث خطأ بالاتصال بالسيرفر');
  }
}
</script>
</body>
</html>
